@using OffertTemplateTool.Models;
@using OffertTemplateTool.DAL.Models;
@model OfferViewModel

@{
    List<EstimateConnectViewModel> lines = (List<EstimateConnectViewModel>)ViewData["estimatelines"];
    ViewData["Title"] = "Edit Offer";

    var lineid = 0;

}

<h2>Edit Offer</h2>
<button class="btn btn-danger cancel-button"><a href="../">Cancel</a></button>
<input type="submit" name="Save" class="btn btn-success Save-offerte" value="Save Offerte" /> <br />
<label>ProjectName:</label> <br />
<div class="row">
    <div class="col-md-2">
        <input asp-for="ProjectName" class="projectname form-control" placeholder="ProjectName" style="margin-bottom: 1%;" /><br />
    </div>
</div>
<label>IndexContent:</label>
<textarea asp-for="IndexContent" class="summernote" name="IndexContent"></textarea>
<label>estimate:</label>
<a class="new">New Line</a>
<div class="row">
    <div class="col-md-2">
        <label>Specification:</label>
    </div>
    <div class="col-md-2">
        <label>Hours:</label>
    </div>
    <div class="col-md-2">
        <label>HoursCost:</label>
    </div>
    <div class="col-md-2">
        <label>TotalCost:</label>
    </div>
</div>
<div class="newline-container">
    @foreach (var item in lines)
    {
        <div class="row new-row">
            <div class="col-md-2">
                <input asp-for="EstimateLines" class="form-control" id="Specification" value="@item.EstimateLines.Specification"/>
            </div>
            <div class="col-md-2">
                <input asp-for="EstimateLines" class="form-control" value="@item.EstimateLines.Hours" />
            </div>
            <div class="col-md-2">
                <input asp-for="EstimateLines" class="form-control" value="@item.EstimateLines.HourCost" />
            </div>
            <div class="col-md-2">
                <input asp-for="EstimateLines" class="form-control" value="@item.EstimateLines.TotalCost" />
            </div>
        </div>

    }
</div>

<input type="submit" name="Save" class="btn btn-success Save-offerte" value="Save Offerte" /> <br />



<script type="text/javascript">
    var id = 0;

    $(document).ready(function () {
        $('.summernote').summernote({
            height: 300
        });
    });

    $(".new").click(function (e) {

        $(".newline-container").append(
            '<div class="row new-row"><div class="col-md-2">' +
            '<input name="EstimateLines" id="Specification' + id +'" placeholder="Specification" />' +
            '</div>' +
                '<div class="col-md-2">' +
            '<input name="EstimateLines" id="hours' + id +'" placeholder="Hours" />' +
                '</div>' +
                '<div class="col-md-2">' +
            '<input name="EstimateLines" id="hourscost' + id +'" placeholder="HoursCost" />' +
                '</div>' +
            '<div class="col-md-2">' +
            '<input name="EstimateLines" id="totalcost' + id +'" placeholder="TotalCost" />' +
                '</div> ' +
            '</div>'
        );
        id++;
        return;
    });

    $(".Save-offerte").click(function (e) {

        saveAll();
        return;
    });

    var saveAll = function () {

        var postBody = {
            "Id": "@Model.Id",
            "DebtorNumber": 0,
            "DocumentCode": 0,
            "ProjectName": $(".projectname").val(),
            "CreatedBy": null,
            "UpdatedBy": null,
            "CreatedAt": null,
            "LastUpdatedAt": "@DateTime.Now",
            "IndexContent": $(".summernote").val(),
            "Estimate": null,
            "EstimateLines": [
            ]
        };

        for (var i = 0; i < id; i++) {
            postBody.EstimateLines[i] = {
                "Specification": $("#Specification" + i).val(),
                "HourCost": $("#hourscost" + i).val(),
                "Hours": $("#hours" + i).val(),
                "TotalCost": $("#totalcost" + i).val()
            };
        }
        
        console.log(postBody);
        
        $.ajax({
            type: "POST",
            url: '@Url.Action("EditOffer","Offer")',
            data: postBody,
            complete: function (response, status, xhr) {

            },
            error: function (response, status, xhr) {

            },
        });

    }
</script>